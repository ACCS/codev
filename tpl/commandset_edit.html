{include file="menu/management_menu.html"}

<script type="text/javascript">

function addCmd() {

   // check fields
   var foundError = 0;
   var msgString = "{t}Missing field{/t}:\n\n";

   if (0 == document.forms["commandForm"].bugid.value) {
      msgString += "{t}command id{/t}\n";
      ++foundError;
   }

   if (0 == foundError) {
     document.forms["commandForm"].teamid.value ="{$teamid}";
     document.forms["commandForm"].cmdid.value="{$commandid}";
     document.forms["commandForm"].action.value="addCommand";
     document.forms["commandForm"].submit();
   } else {
     alert(msgString);
   }
}

function createCmd() {
     document.forms["commandForm"].teamid.value ="{$teamid}";
     document.forms["commandForm"].cmdid.value="{$commandid}";
     document.forms["commandForm"].action.value="createCommand";
     document.forms["commandForm"].submit();

}

</script>


<div id="content">

   {if $commandsetid}
   <div  align="center">
      <h2  title="{$commandsetid}">{$commandsetName}</h2>
   </div>

   <br/><br/>

   <div>
      <!-- create form -->
      <form id='updateServiceInfoForm' name='updateServiceInfoForm' method='post' action='{$page}'>
      <fieldset>

         <table class='invisible'>
               <tr>
                  <th>{t}Name{/t}</th>
                  <td><input type='text' size='80' style='font-family: sans-serif' name='commandsetName'  id='commandsetName' value='{$commandsetName}'></td>
               </tr>
               <tr>
                  <th>{t}Description{/t}</th>
                  <td><textarea rows='4' cols='80' style='font-family: sans-serif' name='commandsetDesc'  id='commandsetDesc'>{$commandsetDesc}</textarea></td>
               </tr>
         </table>
         <br>
         <button type='submit'><img  border='0' align='absmiddle' src="images/b_save.gif" alt="Save icon"/> {t}Save{/t}</button>

         <input type="hidden" name="action" value="updateServiceInfo" />
         <input type="hidden" name="teamid" value="{$teamid}" />
         <input type="hidden" name="commandsetid" value="{$commandsetid}" />
      </fieldset>
      </form>

   </div>

   <div style="margin-top:2em;">
   <br/><br/>


         <div align="left">

         {if $cmdList}
         <script type="text/javascript">
            function removeCmd(cmdid, description){
               jQuery( "#desc_id" ).text(cmdid);
               jQuery( "#desc_summary" ).text(description);

               jQuery( "#formRemoveCmd" ).find("input[name=cmdid]").val(cmdid);

               jQuery( "#removeCmd_dialog_form" ).dialog( "open" );
            }
         </script>
         <script type="text/javascript">
            jQuery(document).ready(function() {
               // delete track dialogBox
               jQuery("#removeCmd_dialog_form" ).dialog({
                  autoOpen: false,
                  resizable: true,
                  width: "auto",
                  modal: true,
                  buttons: {
                     "Remove": function() {
                        jQuery("#formRemoveCmd").submit();
                     },
                     Cancel: function() {
                        jQuery( this ).dialog( "close" );
                     }
                  }
               });
            });
         </script>
         <div id="removeCmd_dialog_form" title="{t}Remove Command{/t}" style="display: none">
            <p><span class="ui-icon ui-icon-alert" style="float:left; margin:0 7px 20px 0;"></span>
               {t}Remove Command from this Service ?{/t}
            </p>
            <table class="invisible">
               <tr>
                  <td><span style="font-weight:bold;">{t}Id{/t} :</span></td>
                  <td id="desc_id">id</td>
               </tr>
               <tr>
                  <td><span style="font-weight:bold;">{t}Description{/t} :</span></td>
                  <td id="desc_summary">summary</td>
               </tr>
            </table>
            <form id="formRemoveCmd" name="formRemoveCmd" method="post" action="{$page}" >
               <fieldset>
                  <input type="hidden" name="action" value="removeCmd" />
                  <input type="hidden" name="cmdid"  value="0" />
                  <input type="hidden" name="teamid" value="{$teamid}" />
                  <input type="hidden" name="commandsetid"  value="{$commandsetid}" />

               </fieldset>
            </form>
         </div>

         <table>
            <thead>
            <tr>
                  <th></th>
                  <th>{t}Command{/t}</th>
            </tr>
            </thead>
            <tbody>
            {foreach $cmdList as $id => $cmd}
            <tr>
                  <td>
                     <a title="{t}delete Service-Command association{/t}"
                        href="javascript: removeCmd('{$id}', '{$cmd.description|escape}')">
                        <img alt="b_drop.png" border="0" src="images/b_drop.png" />
                     </a>
                  </td>
                  <td title="{$id}">{$cmd.name}</td>
            </tr>
            {/foreach}
            </tbody>
         </table>
         {/if}

         <br>

         <div>
            <!-- add/create command form -->
            <form id='addCmdForm' name='addCmdForm' method='post' action='{$page}'>
               <fieldset>
                  <select id='cmdSelector' name='cmdid'>
                     <option value='0'>{t}--- New Command ---{/t}</option>
                     {foreach  $unassignedCmd as $id => $name}
                     <option value="{$id}">{$name}</option>
                     {/foreach}
                  </select>

                  <button type='submit'><img  border='0' align='absmiddle' src="images/b_add.png" alt="Add icon"/> {t}Add{/t}</button>

                  <input type="hidden" name="action" value="addCommand" />
                  <input type="hidden" name="teamid" value="{$teamid}" />
                  <input type="hidden" name="commandsetid" value="{$commandsetid}" />
               </fieldset>
            </form>
         </div>

      </div>


   </div>
   {/if}
</div>