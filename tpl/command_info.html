{include file="menu/management_menu.html"}

<script type="text/javascript">

function setTeam() {
   document.forms["commandSelectForm"].teamid.value = document.getElementById('teamSelector').value;
   document.forms["commandSelectForm"].cmdid.value="0";
   document.forms["commandSelectForm"].action.value="setTeam";
   document.forms["commandSelectForm"].submit();
}

function submitForm() {
   document.forms["commandSelectForm"].teamid.value = document.getElementById('teamSelector').value;
   document.forms["commandSelectForm"].cmdid.value = document.getElementById('commandSelector').value;
   document.forms["commandSelectForm"].action.value = "displayCommand";
   document.forms["commandSelectForm"].submit();
 }

//------ JQUERY --------
$(document).ready(function() {
   $('#issues_table').dataTable(
      {
         "sScrollY": "700px",
         "bPaginate": false,
         "bScrollCollapse": true,
         "bFilter": true,
         "bSort": true,
         "bInfo": false,
         "bAutoWidth": false
      });
      jQuery(function() {
         jQuery( "#tabsCommand" ).tabs();
      });

   $( "#accordion" ).accordion({
      collapsible: true, autoHeight: false, clearStyle: true
   });

});

</script>


<div id="content">

   <div align="center">
      <!-- create form -->
      <form id='commandSelectForm' name='commandSelectForm' method='post' action='{$page}'>
         <fieldset>
            <label>{t}Team{/t}: </label>
            <select id='teamSelector' name='teamid' onchange='javascript: setTeam()'>
               <option value='0'></option>
               {foreach from=$teams key=id item=i}
               <option {if $i.selected}selected="selected"{/if} value="{$i.id}">{$i.name}</option>
               {/foreach}
            </select>
            <label>{t}Command{/t}: </label>
            <select id='commandSelector' name='cmdid'>
               <option value='0'>{t}--- Create New Command ---{/t}</option>
               {foreach from=$commands key=id item=i}
               <option {if $i.selected}selected="selected"{/if} value="{$i.id}">{$i.name}</option>
               {/foreach}
            </select>
            <input type="button" value='{t}Jump{/t}' onclick='javascript: submitForm()' />
            
            <input type="hidden" name="action" value="displayCommand" />
         </fieldset>
      </form>
   </div>

   <div style="margin-top:2em;">
   <br/><br/>
   
   {if $cmdid} 
   <div  align="center">
      <h2>{$cmdReference} {$cmdName}</h2>
      {$cmdDesc}
   </div>

   {if $consistencyErrors}
   <!-- Consistency errors -->
   <div style="margin-top:2em;">
      <div align='center'><div id='accordion' style='width:500px;' >
         <h3><a href='#'>{$consistencyErrorsTitle}</a></h3>
         <div align='left' style='height:100px;'>
            <table class='invisible'>
            {foreach from=$consistencyErrors key=id item=i}
            <tr>
               <td>{$i.issueURL}</td>
               <td><span style='color:red'>{$i.desc}</span></td>
            </tr>
            {/foreach}

            </table>
         </div>
      </div>
   </div>
   {/if}

   <br/><br/>

   <div>
      <table class='invisible'>
            <tr>
               <th>{t}Reference{/t}</th>
               <td>: {$cmdReference}</td>
            </tr>
            <tr>
               <th>{t}Version{/t}</th>
               <td>: {$cmdVersion}</td>
            </tr>
            <tr>
               <th>{t}Reporter{/t}</th>
               <td>: {$cmdReporter}</td>
            </tr>
            <tr>
               <th>{t}Service Contract{/t}</th>
               <td>: {$servicecontract}</td>
            </tr>
            <tr>
               <th>{t}CommandSet{/t}</th>
               <td>: {$commandsetName}</td>
            </tr>
            <tr>
               <th>{t}Date depart{/t}</th>
               <td>: {$cmdStartDate}</td>
            </tr>
            <tr>
               <th>{t}Date fin{/t}</th>
               <td>: {$cmdDeadline}</td>
            </tr>
            <tr>
               <th>{t}State{/t}</th>
               <td>: {$cmdState}</td>
            </tr>
            <tr>
               <th>{t}Cost{/t}</th>
               <td>: {$cmdCost} {$cmdCurrency}</td>
            </tr>
            <tr>
               <th>{t}Budget{/t}</th>
               <td>: {$cmdBudgetDev} {t}days{/t}</td>
            </tr>
      </table>
      <br>
      <button onclick="location.href='management/command_edit.php'"><img  border='0' align='absmiddle' src="images/b_edit.png" alt="Edit icon"/> {t}Edit{/t}</button>
   </div>

   <br/><br/>


   <div style="margin-top:2em;">
   <br/><br/>

   <div id="tabsCommand">
      <ul>
         <li><a href="#tabsName-3">{t}Charges{/t}</a></li>
         <li><a href="#tabsName-1">{t}Tasks{/t} ({$cmdNbIssues})</a></li>
         <li><a href="#tabsName-2">{t}Statistics{/t}</a></li>
      </ul>

      <div id="tabsName-3">
         {if $cmdDetailedMgr}
         <div>
            <table>
               <thead>
               <tr>
                  <th>{t}MgrEffortEstim{/t}</th>
                  <th title="remainingMgr + elapsed">{t}Reestimated Mgr{/t}</th>
                  <th>{t}Elapsed{/t}</th>
                  <th>{t}Remaining Mgr{/t}</th>
                  <th style="width: 80px">{t}Drift Mgr{/t}</th>
               </tr>
               </thead>
               <tbody>
               <tr>
                  <td>{$cmdDetailedMgr.effortEstim}</td>
                  <td>{$cmdDetailedMgr.reestimated}</td>
                  <td>{$cmdDetailedMgr.elapsed}</td>
                  <td>{$cmdDetailedMgr.remaining}</td>
                  <td {$cmdDetailedMgr.driftColor} title="{t}nb days{/t}">{$cmdDetailedMgr.drift}</td>
               </tr>
               </tbody>
            </table>
         </div>
         {else}
         {t}No task found.{/t}
         {/if}
      </div>

      <div id="tabsName-1">

         {if $cmdShortIssueList}
         {t}Short List: {/t}<br>{$cmdShortIssueList}<br>
         {/if}

         {if $cmdIssues}
         <div align="center">
         <table id="issues_table" class="display">
            <thead>
            <tr>
                  <th>{t}ID{/t}</th>
                  <th>{t}Project{/t}</th>
                  <th>{t}Target{/t}</th>
                  <th>{t}Status{/t}</th>
                  <th>{t}Progress{/t}</th>
                  <th>{t}MgrEffortEstim{/t}</th>
                  <th>{t}Elapsed{/t}</th>
                  <th>{t}RAF{/t}</th>
                  <th>{t}Drift Mgr{/t}</th>
                  <th>{t}Summary{/t}</th>
            </tr>
            </thead>
            <tbody>
            {foreach $cmdIssues as $id => $issue}
            <tr>
                  <!--td>{$issue.mantisLink}{$issue.bugid}</td-->
                  <td>{$issue.bugid}</td>
                  <td>{$issue.project}</td>
                  <td>{$issue.target}</td>
                  <td>{$issue.status}</td>
                  <td>{$issue.progress}%</td>
                  <td>{$issue.effortEstim}</td>
                  <td>{$issue.elapsed}</td>
                  <td>{$issue.durationMgr}</td>
                  <td {$issue.driftMgrColor} >{$issue.driftMgr}</td>
                  <td>{$issue.summary}</td>
            </tr>
            {/foreach}
            </tbody>
         </table>
         </div>
         {else}
         {t}No task found.{/t}
         {/if}
      </div>

      <div id="tabsName-2">
         {if $cmdStats}
         comming soon...
         {else}
         {t}No Stats available.{/t}
         {/if}
      </div>

   {/if}

</div>
