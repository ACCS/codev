{include file="menu/management_menu.html"}

<script type="text/javascript">

function setTeam() {
   document.forms["engagementSelectForm"].teamid.value = document.getElementById('teamSelector').value;
   document.forms["engagementSelectForm"].engid.value="0";
   document.forms["engagementSelectForm"].action.value="setTeam";
   document.forms["engagementSelectForm"].submit();
}

function submitForm() {
   document.forms["engagementSelectForm"].teamid.value = document.getElementById('teamSelector').value;
   document.forms["engagementSelectForm"].engid.value = document.getElementById('engagementSelector').value;
   document.forms["engagementSelectForm"].action.value = "displayEngagement";
   document.forms["engagementSelectForm"].submit();
 }

function addEngIssue(){
 
   // check fields
   var foundError = 0;
   var msgString = "{t}Missing field{/t}:\n\n";

   if (0 == document.forms["addEngIssueForm"].bugid.value) {
      msgString += "{t}task id{/t}\n";
      ++foundError;
   }

   if (0 == foundError) {
     document.forms["addEngIssueForm"].teamid.value ="{$teamid}";
     document.forms["addEngIssueForm"].engid.value="{$engagementid}";
     document.forms["addEngIssueForm"].action.value="addEngIssue";
     document.forms["addEngIssueForm"].submit();
   } else {
     alert(msgString);
   }
}

//------ JQUERY --------
$(document).ready(function() {
   $('#issues_table').dataTable(
      {
         "sScrollY": "700px",
         "bPaginate": false,
         "bScrollCollapse": true,
         "bFilter": true,
         "bSort": true,
         "bInfo": false,
         "bAutoWidth": false
      });
} );


</script>


<div id="content">

   <div align="center">
      <!-- create form -->
      <form id='engagementSelectForm' name='engagementSelectForm' method='post' action='{$page}'>
         <fieldset>
            <label>{t}Team{/t}: </label>
            <select id='teamSelector' name='teamid' onchange='javascript: setTeam()'>
               <option value='0'></option>
               {foreach from=$teams key=id item=i}
               <option {if $i.selected}selected="selected"{/if} value="{$i.id}">{$i.name}</option>
               {/foreach}
            </select>
            <label>{t}Engagement{/t}: </label>
            <select id='engagementSelector' name='engid'>
               <option value='0'></option>
               {foreach from=$engagements key=id item=i}
               <option {if $i.selected}selected="selected"{/if} value="{$i.id}">{$i.name}</option>
               {/foreach}
            </select>
            <input type="button" value='{t}Jump{/t}' onclick='javascript: submitForm()' />
            
            <input type="hidden" name="action" value="noAction" />
         </fieldset>
      </form>
   </div>

   <div style="margin-top:2em;">
   <br/><br/>
   
   {if $engid} 
   <div  align="center">
      <h2>{$engName}</h2>
      {$engDesc}
   </div>

   <br/><br/>

   <div>
      <table class='invisible'>
            <tr>
               <th>{t}Date depart{/t}</th>
               <td>: {$engStartDate}</td>
            </tr>
            <tr>
               <th>{t}Date fin{/t}</th>
               <td>: {$engDeadline}</td>
            </tr>
            <tr>
               <th>{t}Budjet Developpement{/t}</th>
               <td>: {$engBudjetDev} {t}days{/t}</td>
            </tr>
            <tr>
               <th>{t}Budjet Management{/t}</th>
               <td>: {$engBudjetMngt} {t}days{/t}</td>
            </tr>
            <tr>
               <th>{t}Budjet Garantie{/t}</th>
               <td>: {$engBudjetGarantie} {t}days{/t}</td>
            </tr>
            
      </table>
   </div>

   <br/><br/>

      {if $engDetailedMgr}
      <div>
         <table>
            <thead>
            <tr>
               <th>{t}MgrEffortEstim{/t}</th>
               <th title="remainingMgr + elapsed">{t}Reestimated Mgr{/t}</th>
               <th>{t}Elapsed{/t}</th>
               <th>{t}Remaining Mgr{/t}</th>
               <th style="width: 80px">{t}Drift Mgr{/t}</th>
            </tr>
            </thead>
            <tbody>
            <tr>
               <td>{$engDetailedMgr.effortEstim}</td>
               <td>{$engDetailedMgr.reestimated}</td>
               <td>{$engDetailedMgr.elapsed}</td>
               <td>{$engDetailedMgr.remaining}</td>
               <td {$engDetailedMgr.driftColor} title="{t}nb days{/t}">{$engDetailedMgr.drift}</td>
            </tr>
            </tbody>
         </table>
      </div>
      {/if}


   <div style="margin-top:2em;">
   <br/><br/>

   <div align="center">
      <!-- create form -->
      <form id='addEngIssueForm' name='addEngIssueForm' method='post' action='{$page}'>
         <fieldset>
            <label>{t}Add task{/t}: </label>
            <input <input  type='text'size='5' value='' name='bugid' id='bugid' />
            <input type="button" value='{t}Add{/t}' onclick='javascript: addEngIssue()' />

            <input type="hidden" name="action" value="noAction" />
            <input type="hidden" name="teamid" value="{$teamId}" />
            <input type="hidden" name="engid" value="{$engagementId}" />
         </fieldset>
      </form>
   </div>


   <div align="center">
    <table id="issues_table" class="display">
      <thead>
        <tr>
            <th></th>
            <th>{t}ID{/t}</th>
            <th>{t}Project{/t}</th>
            <th>{t}Target{/t}</th>
            <th>{t}Status{/t}</th>
            <th>{t}Progress{/t}</th>
            <th>{t}MgrEffortEstim{/t}</th>
            <th>{t}Elapsed{/t}</th>
            <th>{t}RAF{/t}</th>
            <th>{t}Drift Mgr{/t}</th>
            <th>{t}Summary{/t}</th>
        </tr>
      </thead>
      <tbody>
        {foreach $engIssues as $id => $issue}
        <tr>
            <td>
               <a title="{t}delete this row{/t}" href="javascript: removeEngIssue('{$issue.bugid}')">
                  <img alt="{t}delete this row{/t}" border="0" src="images/b_drop.png" />
               </a>
            </td>
            <td>{$issue.bugid}</td>
            <td>{$issue.project}</td>
            <td>{$issue.target}</td>
            <td>{$issue.status}</td>
            <td>{$issue.progress}%</td>
            <td>{$issue.effortEstim}</td>
            <td>{$issue.elapsed}</td>
            <td>{$issue.durationMgr}</td>
            <td>{$issue.driftMgr}</td>
            <td>{$issue.summary}</td>
        </tr>
        {/foreach}
      </tbody>
    </table>
   </div>

   {/if}

</div>
